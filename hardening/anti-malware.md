## ClamAV
After installation, `freshclam` (the updater service), should be reconfigured: `sudo dpkg-reconfigure clamav-freshclam`
Choose `daemon` type, disable `clamd notification` as we do not use it, enable `bytecode`, enable `log rotation`.

## Chkrootkit
By default, chkrootkit comes with a an inactive daily cronjob.
+ Check `/etc/cron.daily/` if the job exists.
+ Edit `/etc/chkrootkit.conf`:
```
RUN_DAILY="true"
RUN_DAILY_OPTS="-q"
DIFF_MODE="false"
```

## Rkhunter
Some known false positives on Debian 10 needs to be whitelisted.
+ Create/edit `/etc/rkhunter.conf.local`:
```
# Cronjob already includes mail command
# MAIL-ON-WARNING="root@localhost"
# MAIL_CMD=mail -s "[rkhunter] Warnings found for ${HOST_NAME}"
APPEND_LOG=1
PKGMGR=DPKG
ALLOWIPCPROC=/usr/bin/firefox
ALLOWIPCPROC=/usr/bin/vlc
SCRIPTWHITELIST=/usr/bin/fgrep
SCRIPTWHITELIST=/usr/bin/egrep
SCRIPTWHITELIST=/usr/bin/which
SCRIPTWHITELIST=/usr/bin/lwp-request
```

+ In Debian 10, rkhunter places daily cron job, but the config for the cronjob (not the rkhunter command run in the job) is sourced from the `/etc/default/rkhunter`. Rkhunter also places an APT hook, which again sources from `etc/default/rkhunter`. Therefore, edit `/etc/default/rkhunter` to include:

```
CRON_DAILY_RUN="yes"
REPORT_EMAIL="root@localhost"
APT_AUTOGEN="yes"
```
Note: Since `PKGMGR=DPKG` is in the config file, there is no need to add a `DPKG PRE-INVOKE` hook, as the package info comes from dpkg.

+ Check config by: `sudo rkhunter --config-check`.
`Invalid WEB_CMD configuration option: Relative pathname: "/bin/false"` warning can be omitted.

+ Update properties: `sudo rkhunter --propupd`

## Tripwire
During the installation, it will ask to set a local and a site key.

+ Init the database: `sudo tripwire --init`
+ Run the first check: `sudo tripwire --check`. It will print errors about the files/folders that does not exist. The policy file needs needs to be adjusted accordingly.
+ It would be considerable to comment out `/var/log` directory because of the high change rate, it would bypass detecting the changes in log files though. In addition, comment out the non-existent files/folders in the policy file `/etc/tripwire/twpol.txt`. `/proc` is highly volatile, also comment it out from the policy, but keep/add the following sub-directories for Debian 10:
```
#
# Critical devices
#
(
  rulename = "Devices & Kernel information",
  severity = $(SIG_HI),
)
{
	/dev		-> $(Device) ;
	#/proc		-> $(Device) ;
        /proc/devices           -> $(Device) ;
        /proc/net               -> $(Device) ;
        /proc/tty               -> $(Device) ;
        /proc/sys               -> $(Device) ;
        /proc/cpuinfo           -> $(Device) ;
        /proc/modules           -> $(Device) ;
        /proc/mounts            -> $(Device) ;
        /proc/dma               -> $(Device) ;
        /proc/filesystems       -> $(Device) ;
        /proc/interrupts        -> $(Device) ;
        /proc/ioports           -> $(Device) ;
        #/proc/scsi              -> $(Device) ;
        /proc/kcore             -> $(Device) ;
        /proc/self              -> $(Device) ;
        /proc/kmsg              -> $(Device) ;
        /proc/stat              -> $(Device) ;
        /proc/loadavg           -> $(Device) ;
        /proc/uptime            -> $(Device) ;
        /proc/locks             -> $(Device) ;
        /proc/meminfo           -> $(Device) ;
        /proc/misc              -> $(Device) ;
}



# These files change every time the system boots
#
(
  rulename = "System boot changes",
  severity = $(SIG_HI)
)
{
        /var/lock               -> $(SEC_CONFIG) ;
        /var/run                -> $(SEC_CONFIG) ; # daemon PIDs
        #/var/log               -> $(SEC_CONFIG) ;
}


```
+ `cups` and `teamviwer` files also have a high changing rate. If they are needed to be ignored by tripwire, add the lines beginning with `!` to the relevant parts:
```
#
# Other configuration files
#
(
  rulename = "Other configuration files",
  severity = $(SIG_MED)
)
{
	<THIS IS WHERE other /etc CONF RESIDE>
	!/etc/cups ;
	!/etc/cups/subscriptions.conf ;
	!/etc/cups/subscriptions.conf.O ;
	!/etc/teamviewer ;
	!/etc/teamviewer/global.conf ;
}

# These files change the behavior of the root account
(
  rulename = "Root config files",
  severity = 100
)
{
  <THIS IS WHERE other /root CONF RESIDE>
	!/root/.local/share/teamviewer14/logfiles/Connections.txt ;
}
```

+ Generate the encrypted policy file: `sudo twadmin -m P /etc/tripwire/twpol.txt`

+ Add/change the following lines in `/etc/tripwire/twcfg.txt` so that it sends mail to the localhost:
```
MAILMETHOD    =SENDMAIL
MAILPROGRAM   =/usr/bin/mail -t
GLOBALEMAIL   =root@localhost
```

+ Generate the signed config file: `sudo twadmin --create-cfgfile -S /etc/tripwire/site.key /etc/tripwire/twcfg.txt`

+ Check if a cron job already exists. In Debian 10, tripwire already comes with a cron job in `/etc/cron.daily/tripwire`.

+ Re-init the database: `sudo tripwire --init`

+ Check if mail is working: `sudo tripwire --check --quiet --email-report`

+ If you need to update the database after system changes: `sudo tripwire --update --twrfile /var/lib/tripwire/report/<LAST_REPORT>`
